<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Personal AI Orchestration Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app">
      <header class="top-bar">
        <div>
          <h1>Personal AI Orchestration</h1>
          <p class="subtitle">Agent task control, activity, and config health</p>
        </div>
        <div class="connection" id="connection-status" data-state="disconnected">Disconnected</div>
      </header>

      <section class="card settings-card" id="settings-card">
        <header class="card-header">
          <h2>Connections</h2>
          <button type="button" class="ghost" id="toggle-settings">Collapse</button>
        </header>
        <form id="settings-form" class="settings-grid">
          <label>
            <span>Orchestrator API Base URL</span>
            <input name="orchestratorUrl" type="url" placeholder="https://orchestrator.example.com" required />
          </label>
          <label>
            <span>WebSocket URL <small>(optional)</small></span>
            <input name="websocketUrl" type="url" placeholder="ws://orchestrator/ws" />
          </label>
          <label>
            <span>Logging API Base URL <small>(optional)</small></span>
            <input name="loggingUrl" type="url" placeholder="https://logging.example.com" />
          </label>
          <label>
            <span>Echo Agent Base URL <small>(config inspector)</small></span>
            <input name="echoUrl" type="url" placeholder="https://echo-agent.example.com" />
          </label>
          <label>
            <span>Call Agent Base URL <small>(optional)</small></span>
            <input name="callAgentUrl" type="url" placeholder="https://call-agent-svc.onrender.com" />
          </label>
          <label>
            <span>Render Control Base URL <small>(config inspector)</small></span>
            <input name="renderctlUrl" type="url" placeholder="https://renderctl.example.com" />
          </label>
          <label>
            <span>Twilio API Base URL <small>(optional)</small></span>
            <input name="twilioBaseUrl" type="url" placeholder="https://api.twilio.com" />
          </label>
          <label>
            <span>HubSpot API Base URL <small>(optional)</small></span>
            <input name="hubspotBaseUrl" type="url" placeholder="https://api.hubapi.com" />
          </label>
          <label>
            <span>OpenAI API Base URL <small>(optional)</small></span>
            <input name="openaiBaseUrl" type="url" placeholder="https://api.openai.com" />
          </label>
          <label>
            <span>Google API Base URL <small>(optional)</small></span>
            <input name="googleBaseUrl" type="url" placeholder="https://www.googleapis.com" />
          </label>
          <label>
            <span>Basic Auth Username</span>
            <input name="username" type="text" autocomplete="username" />
          </label>
          <label>
            <span>Basic Auth Password</span>
            <input name="password" type="password" autocomplete="current-password" />
          </label>
          <div class="settings-actions">
            <button type="submit" class="primary">Save &amp; Connect</button>
            <button type="button" id="clear-settings" class="ghost">Clear</button>
          </div>
        </form>
        <p class="hint">Credentials are stored only in this browser via localStorage for quick reconnects.</p>
      </section>

      <section class="card oauth-card" id="oauth-card">
        <header class="card-header">
          <h2>Google Integrations</h2>
          <button type="button" class="ghost" id="toggle-oauth">Collapse</button>
        </header>
        <div id="oauth-content" class="oauth-content">
          <div class="oauth-section">
            <div class="oauth-info">
              <h3>ðŸ“§ Gmail Access</h3>
              <p>Connect Gmail to send and read emails through the AI agents.</p>
              <div class="oauth-status" id="gmail-status">
                <span class="status-badge" id="gmail-badge">Checking...</span>
                <span class="oauth-details" id="gmail-details"></span>
              </div>
            </div>
            <div class="oauth-actions">
              <button type="button" class="primary" id="authorize-gmail">Authorize Gmail</button>
              <button type="button" class="ghost" id="revoke-gmail" style="display: none;">Revoke</button>
            </div>
          </div>

          <div class="oauth-section">
            <div class="oauth-info">
              <h3>ðŸ“… Calendar Access</h3>
              <p>Connect Google Calendar to create and manage calendar events.</p>
              <div class="oauth-status" id="calendar-status">
                <span class="status-badge" id="calendar-badge">Checking...</span>
                <span class="oauth-details" id="calendar-details"></span>
              </div>
            </div>
            <div class="oauth-actions">
              <button type="button" class="primary" id="authorize-calendar">Authorize Calendar</button>
              <button type="button" class="ghost" id="revoke-calendar" style="display: none;">Revoke</button>
            </div>
          </div>

          <div class="oauth-section">
            <div class="oauth-info">
              <h3>ðŸ”— Combined Access</h3>
              <p>Authorize both Gmail and Calendar access in one step.</p>
              <div class="oauth-status" id="combined-status">
                <span class="status-badge" id="combined-badge">Ready</span>
                <span class="oauth-details" id="combined-details"></span>
              </div>
            </div>
            <div class="oauth-actions">
              <button type="button" class="primary" id="authorize-combined">Authorize Both</button>
              <button type="button" class="ghost" id="revoke-all" style="display: none;">Revoke All</button>
            </div>
          </div>

          <div class="oauth-debug" id="oauth-debug" style="display: none;">
            <h4>Debug Information</h4>
            <pre id="oauth-debug-log"></pre>
          </div>
        </div>
        <p class="hint">OAuth tokens are encrypted and stored securely on the server. Authorization persists across browser sessions.</p>
      </section>

      <section class="grid">
        <div class="column">
          <article class="card" id="task-summary-card">
            <header class="card-header">
              <h2>Task Summary</h2>
              <button type="button" class="ghost" id="refresh-tasks">Refresh</button>
            </header>
            <dl class="summary" id="task-summary">
              <div><dt>Total</dt><dd id="summary-total">0</dd></div>
              <div><dt>Queued</dt><dd id="summary-queued">0</dd></div>
              <div><dt>Running</dt><dd id="summary-running">0</dd></div>
              <div><dt>Done</dt><dd id="summary-done">0</dd></div>
              <div><dt>Error</dt><dd id="summary-error">0</dd></div>
            </dl>
          </article>

          <article class="card" id="task-table-card">
            <header class="card-header">
              <h2>Tasks</h2>
            </header>
            <form id="task-filter-form" class="filters">
              <label>
                <span>Status</span>
                <select name="status">
                  <option value="">All</option>
                  <option value="queued">Queued</option>
                  <option value="running">Running</option>
                  <option value="done">Done</option>
                  <option value="error">Error</option>
                </select>
              </label>
              <label>
                <span>Correlation ID</span>
                <input name="corrId" type="text" placeholder="optional" />
              </label>
              <label>
                <span>Limit</span>
                <input name="limit" type="number" min="1" max="200" value="50" />
              </label>
              <button type="submit" class="primary">Apply</button>
            </form>
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Updated</th>
                    <th>Correlation</th>
                  </tr>
                </thead>
                <tbody id="task-table-body">
                  <tr class="empty"><td colspan="5">Connect to view tasks.</td></tr>
                </tbody>
              </table>
            </div>
          </article>

          <article class="card" id="task-detail-card">
            <header class="card-header">
              <h2>Task Detail</h2>
            </header>
            <div id="task-detail" class="task-detail empty">Select a task to inspect payload, result, and events.</div>
          </article>

          <article class="card" id="new-task-card">
            <header class="card-header">
              <h2>New Task</h2>
            </header>
            <form id="new-task-form" class="new-task-form">
              <label>
                <span>Type</span>
                <input name="type" type="text" value="echo" required />
              </label>
              <label>
                <span>Source</span>
                <input name="source" type="text" value="dashboard" required />
              </label>
              <label>
                <span>Correlation ID</span>
                <input name="corrId" type="text" placeholder="optional" />
              </label>
              <label class="full">
                <span>Payload (JSON)</span>
                <textarea name="payload" rows="6" placeholder='{"message":"hello"}'></textarea>
              </label>
              <button type="submit" class="primary">Queue Task</button>
              <p class="form-feedback" id="new-task-feedback"></p>
            </form>
          </article>

          <article class="card" id="voice-call-card">
            <header class="card-header">
              <h2>Voice Call Tester</h2>
            </header>
            <form id="voice-call-form" class="voice-call-form">
              <label>
                <span>Destination Number</span>
                <input name="phone" type="tel" placeholder="+15551234567" required />
              </label>
              <label class="full">
                <span>Message Prompt <small>(optional)</small></span>
                <textarea name="message" rows="4" placeholder="Say hello and introduce yourself"></textarea>
              </label>
              <button type="submit" class="primary" id="voice-call-submit">Start Call</button>
              <p class="form-feedback" id="voice-call-status"></p>
            </form>
          </article>

          <article class="card" id="db-snapshot-card">
            <header class="card-header">
              <h2>Database Snapshot</h2>
              <button type="button" class="ghost" id="refresh-db-snapshot">Refresh</button>
            </header>
            <div id="db-snapshot" class="db-snapshot">
              Connect to the orchestrator and logging services to load recent records.
            </div>
          </article>
        </div>

        <div class="column">
          <article class="card" id="activity-card">
            <header class="card-header">
              <h2>Activity Stream</h2>
            </header>
            <ul class="activity" id="activity-list">
              <li class="empty">Waiting for connectionâ€¦</li>
            </ul>
          </article>

          <article class="card" id="connectivity-card">
            <header class="card-header">
              <h2>Service Connectivity</h2>
              <button type="button" class="ghost" id="run-connectivity">Run Check</button>
            </header>
            <div id="connectivity-results" class="connectivity-results">
              Provide service URLs above to run connectivity checks.
            </div>
          </article>

          <article class="card" id="debug-card">
            <header class="card-header">
              <h2>Diagnostics Log</h2>
              <div class="card-actions">
                <button type="button" class="ghost" id="copy-logs">Copy All</button>
                <button type="button" class="ghost" id="clear-logs">Clear</button>
              </div>
            </header>
            <div id="log-output" class="log-output">
              Run connectivity or other actions to populate debug logs here.
            </div>
          </article>

          <article class="card" id="config-card">
            <header class="card-header">
              <h2>Config Inspector</h2>
              <button type="button" class="ghost" id="refresh-config">Refresh</button>
            </header>
            <div id="config-results" class="config-results">
              Provide service URLs above to run config validation.
            </div>
          </article>
        </div>
      </section>
    </div>

    <template id="activity-item-template">
      <li class="activity-item">
        <div class="activity-meta">
          <span class="activity-type"></span>
          <time></time>
        </div>
        <div class="activity-summary"></div>
        <pre class="activity-detail"></pre>
      </li>
    </template>

    <script src="./config.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>
